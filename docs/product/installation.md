# 融禹智慧综合能源管理系统安装部署指南

## 1. 部署前准备

### 1.1 系统需求

#### 服务器硬件要求
- **应用服务器**：
  - CPU: 至少8核心，推荐16核心或以上
  - 内存: 至少32GB，推荐64GB或以上
  - 硬盘: 至少1TB SSD，用于系统和应用程序
  - 网络: 千兆网卡，推荐双网卡冗余配置

- **数据库服务器**：
  - CPU: 至少16核心，推荐32核心或以上
  - 内存: 至少64GB，推荐128GB或以上
  - 硬盘: 至少2TB SSD/NVMe存储，推荐RAID配置
  - 网络: 千兆网卡，推荐双网卡冗余配置

- **边缘计算网关**（每个监测点）：
  - CPU: 四核工业级处理器
  - 内存: 8GB或以上
  - 存储: 128GB或以上工业级存储
  - 接口: RS485/232, 4G/5G, 以太网, CAN总线等

#### 软件环境要求
- **操作系统**：
  - 服务器: CentOS 7.9+/Ubuntu 20.04 LTS+/Windows Server 2019+
  - 边缘网关: 嵌入式Linux

- **数据库**：
  - PostgreSQL 13.0+（主数据库）
  - Redis 6.0+（缓存）
  - InfluxDB 2.0+（时序数据）

- **支持软件**：
  - Docker 20.10+和Docker Compose 2.0+
  - Nginx 1.20+
  - RabbitMQ 3.8+
  - JDK 11+ (后端服务)
  - Node.js 16+ (前端服务)

### 1.2 网络准备
- 确保服务器间网络互通，推荐使用独立VLAN
- 配置合适的防火墙规则和访问控制
- 确保边缘网关到中心服务器的网络连接稳定
- 预留固定IP地址及DNS配置

### 1.3 账号准备
- 创建专用系统管理员账号
- 准备数据库管理员账号
- 准备系统服务账号（低权限）
- 准备SMTP服务账号（用于系统通知）

### 1.4 安全措施
- 服务器安全加固
- SSL证书准备（用于Web界面和API加密）
- 数据加密密钥管理方案
- 备份策略制定

## 2. 安装流程

### 2.1 硬件安装

#### 服务器安装
1. 服务器上架并接入网络
2. 配置RAID（如适用）
3. 安装身份验证设备（如适用）
4. 连接UPS电源

#### 边缘网关安装
1. 边缘网关固定安装在指定位置
2. 连接电源和网络
3. 连接相关传感器和设备:
   - 智能电表（通过RS485/Modbus）
   - 温湿度传感器
   - 水表、气表、热表等
   - 各类控制器和执行器

### 2.2 软件安装

#### 中心服务器部署
1. **操作系统安装**
   ```bash
   # 安装必要系统工具
   sudo yum update -y  # CentOS
   sudo apt update && sudo apt upgrade -y  # Ubuntu
   
   # 安装基础软件包
   sudo yum install -y curl wget git vim net-tools  # CentOS
   sudo apt install -y curl wget git vim net-tools  # Ubuntu
   ```

2. **Docker安装**
   ```bash
   # 安装Docker
   curl -fsSL https://get.docker.com | sh
   
   # 启动Docker服务
   sudo systemctl enable docker
   sudo systemctl start docker
   
   # 安装Docker Compose
   sudo curl -L "https://github.com/docker/compose/releases/download/v2.12.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
   sudo chmod +x /usr/local/bin/docker-compose
   ```

3. **部署数据库服务**
   ```bash
   # 创建存储目录
   sudo mkdir -p /data/postgres /data/influxdb /data/redis
   
   # 部署数据库服务
   cd /opt
   git clone https://github.com/rongyu-energy/deployment.git
   cd deployment/database
   sudo docker-compose up -d
   ```

4. **部署应用服务**
   ```bash
   # 部署应用服务
   cd /opt/deployment/application
   
   # 修改配置文件
   sudo cp .env.example .env
   sudo vim .env  # 按实际情况修改环境变量
   
   # 启动应用服务
   sudo docker-compose up -d
   ```

5. **部署Web服务**
   ```bash
   # 部署Web前端
   cd /opt/deployment/web
   sudo docker-compose up -d
   
   # 配置Nginx
   sudo cp nginx/rongyu.conf /etc/nginx/conf.d/
   sudo nginx -t
   sudo systemctl restart nginx
   ```

#### 边缘网关部署
1. **基础系统配置**
   ```bash
   # 安装边缘软件包
   sudo dpkg -i rongyu-edge-gateway.deb  # Debian-based systems
   
   # 或者使用容器部署
   sudo docker run -d --restart=always --network=host -v /data:/data rongyu/edge-gateway:latest
   ```

2. **网关配置**
   ```bash
   # 编辑配置文件
   sudo vim /etc/rongyu/gateway.conf
   
   # 配置中心服务器连接
   server_address=https://your-server-address
   api_key=your-api-key
   location_id=your-location-id
   ```

3. **设备接入配置**
   ```bash
   # 扫描Modbus设备
   sudo rongyu-device-scan --port=/dev/ttyS0 --baud=9600
   
   # 加载设备模板
   sudo rongyu-device-add --type=meter --model=DTS634 --port=/dev/ttyS0 --address=1
   ```

### 2.3 系统初始化

1. **访问管理控制台**
   - 打开浏览器，访问 `https://your-server-address/admin`
   - 使用默认管理员账号登录：
     - 用户名: admin
     - 密码: 首次登录需修改默认密码

2. **基础配置**
   - 系统信息配置
   - 组织架构配置
   - 用户角色和权限配置
   - 邮件/短信通知配置

3. **资产配置**
   - 设施点位定义
   - 设备资产录入
   - 边缘网关关联
   - 能源计量点配置

4. **业务配置**
   - 能源计费规则配置
   - 报表模板配置
   - 告警规则配置
   - 数据采集任务配置

## 3. 系统集成

### 3.1 数据采集点接入
1. **电表接入**
   - 确认电表通信参数
   - 配置数据采集模板
   - 设置采集频率
   - 验证数据读取正确性

2. **BMS系统集成**
   - 配置BMS通信接口
   - 映射数据点位关系
   - 建立双向数据交互机制

3. **其他能源表计接入**
   - 热量表/水表/气表接入
   - 环境传感器接入
   - 设置相应的转换系数和单位

### 3.2 控制系统集成
1. **空调系统控制接口**
   - 配置控制协议和参数
   - 设置控制权限和优先级
   - 建立控制策略

2. **照明系统集成**
   - 配置照明控制接口
   - 设置场景模式
   - 建立智能调光策略

3. **其他可控设备集成**
   - 配置设备控制接口
   - 设置控制参数和安全策略

### 3.3 外部系统集成
1. **企业ERP系统集成**
   - 配置数据交换接口
   - 设置成本核算数据同步
   - 建立资产管理关联

2. **碳排放监测系统集成**
   - 配置碳排放因子
   - 设置数据交换机制
   - 建立碳资产管理流程

## 4. 系统测试

### 4.1 功能测试
1. **数据采集测试**
   - 验证各类能源数据正确采集
   - 测试采集频率和精度
   - 检查异常数据处理机制

2. **分析功能测试**
   - 验证能效分析算法
   - 测试负荷预测准确性
   - 检查优化建议生成逻辑

3. **控制功能测试**
   - 验证设备控制响应
   - 测试自动控制逻辑
   - 检查控制安全机制

4. **报表功能测试**
   - 验证各类报表生成
   - 测试导出功能
   - 检查数据一致性

### 4.2 性能测试
1. **系统负载测试**
   - 模拟大量设备并发接入
   - 测试数据处理能力
   - 检查系统响应时间

2. **数据存储测试**
   - 验证海量数据存储能力
   - 测试数据查询性能
   - 检查数据压缩和归档机制

### 4.3 安全测试
1. **访问控制测试**
   - 验证权限设置有效性
   - 测试身份认证机制
   - 检查敏感操作审计日志

2. **数据安全测试**
   - 验证数据传输加密
   - 测试数据访问控制
   - 检查数据备份恢复机制

## 5. 系统上线

### 5.1 用户培训
1. **管理员培训**
   - 系统架构和原理培训
   - 管理控制台操作培训
   - 常见问题处理培训
   - 系统维护流程培训

2. **操作员培训**
   - 日常操作流程培训
   - 数据分析工具使用培训
   - 报表查询和导出培训
   - 告警处理流程培训

3. **普通用户培训**
   - 数据查看权限培训
   - 移动应用使用培训
   - 能源使用建议理解培训

### 5.2 系统验收
1. **功能验收**
   - 核对功能清单
   - 验证关键功能正确性
   - 确认用户界面可用性

2. **性能验收**
   - 验证系统响应时间
   - 确认数据处理能力
   - 测试系统稳定性

3. **文档验收**
   - 核对技术文档完整性
   - 验证用户手册可用性
   - 确认培训材料有效性

### 5.3 系统交付
1. **签署验收文档**
2. **移交系统账号和密码**
3. **提供技术支持联系方式**
4. **安排后续维护计划**

## 6. 运维与维护

### 6.1 日常维护
1. **系统监控**
   - 服务器资源监控
   - 应用服务状态监控
   - 数据采集状态监控
   - 设备连接状态监控

2. **数据备份**
   - 定期数据库备份
   - 系统配置备份
   - 重要日志备份
   - 备份有效性验证

3. **性能优化**
   - 数据库优化
   - 缓存策略调整
   - 历史数据归档
   - 系统资源调配

### 6.2 系统升级
1. **版本升级计划**
   - 确定升级时间和范围
   - 制定升级步骤
   - 准备回滚方案

2. **升级执行**
   ```bash
   # 备份当前配置
   sudo cp -r /opt/deployment /opt/deployment.bak
   
   # 更新代码库
   cd /opt/deployment
   git pull
   
   # 执行升级脚本
   sudo ./upgrade.sh
   ```

3. **升级验证**
   - 验证新功能可用性
   - 确认原有功能正常
   - 检查数据一致性

### 6.3 故障处理
1. **常见问题诊断**
   - 数据采集异常诊断
   - 系统响应缓慢诊断
   - 服务无法访问诊断

2. **紧急恢复流程**
   ```bash
   # 重启服务
   cd /opt/deployment
   sudo docker-compose restart
   
   # 恢复备份
   sudo cp -r /data/backup/postgres-latest /data/postgres
   ```

3. **技术支持渠道**
   - 7×24小时技术支持热线：400-XXX-XXXX
   - 邮件支持：support@rongyu-energy.com
   - 远程支持工具安装方法

## 7. 附录

### 7.1 系统架构图
```
+---------------------------+
|      用户访问层           |
|  Web门户 | 移动APP | 大屏  |
+---------------------------+
           |
+---------------------------+
|      应用服务层           |
| 能源分析 | 优化调度 | 报表 |
+---------------------------+
           |
+---------------------------+
|      数据服务层           |
| 实时数据库 | 历史数据库   |
+---------------------------+
           |
+---------------------------+
|      通信接入层           |
| 协议转换 | 数据缓存 | 安全 |
+---------------------------+
           |
+---------------------------+
|      设备感知层           |
| 智能电表 | 传感器 | 控制器 |
+---------------------------+
```

### 7.2 常见问题解答
1. **系统无法启动怎么办？**
   - 检查服务器资源使用情况
   - 验证数据库服务是否正常
   - 查看应用日志定位具体错误

2. **数据采集中断怎么处理？**
   - 检查网关连接状态
   - 验证设备通信参数
   - 重启数据采集服务

3. **Web界面加载缓慢怎么优化？**
   - 检查网络带宽使用情况
   - 优化数据库查询
   - 增加Web服务器缓存

### 7.3 联系方式
- **技术支持热线**：400-XXX-XXXX
- **邮件支持**：support@rongyu-energy.com
- **官方网站**：www.rongyu-energy.com
- **公司地址**：XX省XX市XX区XX路XX号

---

© 2025 融禹能源科技有限公司，保留所有权利